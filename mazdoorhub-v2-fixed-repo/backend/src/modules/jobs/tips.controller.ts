import { Controller, Post, Param, Body } from '@nestjs/common'; import { DataSource } from 'typeorm'; @Controller('v1/jobs') export class TipsController { constructor(private ds: DataSource) {} @Post(':id/tip') async tip(@Param('id') id: string, @Body() body: { from_id: string; to_id: string; amount: number }){ const q = `INSERT INTO ledgers (user_id, job_id, type, amount, meta) VALUES ($1,$2,'tip',$3, $4) RETURNING *`; const r = await this.ds.query(q, [body.to_id, id, body.amount, JSON.stringify({ from: body.from_id }) ]); return r[0]; } }