import { Controller, Post, Body } from '@nestjs/common'; import { SmsService } from '../../integrations/sms.service'; @Controller('v1/safety') export class SosController { constructor(private sms: SmsService) {} @Post('sos') async sos(@Body() body: { to: string; worker_id: string; lat?: number; lon?: number; job_id?: string }){ const msg = `SOS from worker ${body.worker_id}${body.job_id ? ' on job '+body.job_id : ''}${(body.lat&&body.lon)? ' at http://maps.google.com/?q='+body.lat+','+body.lon : ''}`; const res = await this.sms.send(body.to, msg); return { ok: true, sent: res }; } }